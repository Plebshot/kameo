---
title: 请求概述
---

在Kameo的上下文中，请求是演员之间进行通信和交互的手段。这些交互被封装在两种主要形式中：询问请求和告知请求。理解这两种类型请求之间的细微差别对于有效管理演员行为和确保应用程序的健壮性至关重要。

### 询问请求

询问请求是一种发送消息的形式，其中发送者等待接收者的响应。当发送者在继续之前需要数据或确认某个动作已经完成时，这种模式非常有用。与告知请求不同，询问请求固有地支持处理响应和错误，提供了一种直接处理异常条件的方式。

询问请求的关键特点：

- **等待回复**：发送者暂停其执行并等待回复，使其在异步执行模型中本质上是同步的。
- **错误处理**：如果演员在处理询问请求时遇到错误，处理这些错误的责任落在了调用者身上。这允许更细粒度的错误管理策略。
- **超时**：
	- **邮箱超时**：对于具有有界邮箱的演员，可以指定一个可选的`mailbox_timeout`。这个超时表示请求在队列中等待被处理的最长时间。如果邮箱在这段时间内仍然满载，请求可能会被丢弃或返回错误。
	- **回复超时**：也可以设置一个`reply_timeout`，表示发送者将等待响应的时间长短。这对于避免在接收者可能无法及时处理请求的情况下无限期阻塞特别有用。

### 告知请求

另一方面，告知请求是一种“发射后忘记”的消息类型。当发送一个告知请求时，发送者不等待接收者的任何确认或回复。这种方法适用于通知或命令，其中结果不直接影响发送者的即时行动。

告知请求的特征：

- **无回复**：发送者在不等待响应的情况下继续其执行，体现了真正的异步交互模式。
- **错误处理**：演员在处理告知请求时遇到的错误被视为恐慌。默认情况下，这种恐慌可能导致演员停止，尽管通过`Actor::on_panic`钩子可以自定义此行为，以允许错误恢复或日志记录。
- **邮箱超时**：与询问请求类似，可以为发送到有界邮箱的演员的告知请求设置一个`mailbox_timeout`。这个超时有助于管理演员邮箱可能已满的情况下的排队行为，确保系统能够优雅地处理背压。

### 请求方法

使用下表中列出的特性/方法之一可以发送消息。每个单元格根据邮箱类型描述了实现的行为。

列标题描述如下：

- **询问（有界）**：指的是在具有`BoundedMailbox`的演员上使用`ask`发送消息。
- **询问（无界）**：指的是在具有`UnboundedMailbox`的演员上使用`ask`发送消息。
- **告知（有界）**：指的是在具有`BoundedMailbox`的演员上使用`tell`发送消息。
- **告知（无界）**：指的是在具有`UnboundedMailbox`的演员上使用`tell`发送消息。


| **特性** **::** **方法**                            | **询问（有界）**                        | **询问（无界）**                 | **告知（有界）**           | **告知（无界）** |
| ----------------------------------------------- | --------------------------------- | -------------------------- | -------------------- | ---------- |
| `MessageSend` :: `send`                         | 发送消息，等待邮箱容量和回复。                   | 发送消息，等待回复。                 | 发送消息，等待邮箱容量。         | 发送消息。      |
| `MessageSendSync` :: `send_sync`                | ❌                                 | ❌                          | ❌                    | 同步发送消息。    |
| `TryMessageSend` :: `try_send`                  | 尝试发送消息，等待回复，但如果邮箱已满则失败。           | 发送消息，等待回复。                 | 尝试发送消息，但如果邮箱已满则失败。   | 发送消息。      |
| `TryMessageSendSync` :: `try_send_sync`         | ❌                                 | ❌                          | 尝试同步发送消息，但如果邮箱已满则失败。 | 同步发送消息。    |
| `BlockingMessageSend` :: `blocking_send`        | 发送消息，阻塞线程同时等待邮箱容量和回复。             | 发送消息，阻塞线程同时等待回复。           | 发送消息，阻塞线程同时等待邮箱容量。   | 发送消息。      |
| `TryBlockingMessageSend` :: `try_blocking_send` | 尝试发送消息，阻塞线程同时等待回复，但如果邮箱已满则失败。     | 尝试发送消息，阻塞线程同时等待回复。         | 尝试发送消息，但如果邮箱已满则失败。   | 发送消息。      |
| `ForwardMessageSend` :: `forward`               | 发送消息，等待邮箱容量，回复被转发给提供的ReplySender。 | 发送消息，回复被转发给提供的ReplySender。 | ❌                    | ❌          |

#### **支持的请求**

根据消息是在设置了超时的情况下发送还是发送给远程演员，某些方法可能不可用。下表显示了在不同情况下哪些方法可用。

|                      |            |            |            |            |
| -------------------- | ---------- | ---------- | ---------- | ---------- |
| **特性** **::** **方法** | **询问（有界）** | **询问（无界）** | **告知（有界）** | **告知（无界）** |
| `send`               | ✅ 📬 ⏳ 🌐  | ✅ ⏳ 🌐     | ✅ 📬 🌐    | ✅ 🌐       |
| `send_sync`          | ❌          | ❌          | ❌          | ✅          |
| `try_send`           | ✅ ⏳ 🌐     | ✅ ⏳ 🌐     | ✅ 🌐       | ✅ 🌐       |
| `try_send_sync`      | ❌          | ❌          | ✅          | ✅          |
| `blocking_send`      | ✅          | ✅          | ✅          | ✅          |
| `try_blocking_send`  | ✅          | ✅          | ✅          | ✅          |
| `forward`            | ✅ 📬       | ✅          | ❌          | ❌          |

**图例**

- ✅ **支持**：对于没有设置超时的本地演员支持
- 📬 **带邮箱超时**：对于设置了邮箱超时的本地演员支持
- ⏳ **带回复超时**：对于设置了回复超时的本地演员支持
- 🌐 **远程**：支持远程演员消息传递
- ❌ **不支持**

---

#### 总结

请求，包括询问和告知模式，为Kameo内的通信提供了多样化的策略。这种二元性提供了灵活性，既可以等待关键操作的响应，也可以在没有直接反馈的情况下继续更自主的行动。这种多功能性是支持广泛应用需求的关键，从简单的通知到复杂的数据交换和控制流，增强了您的演员交互的动态性和效率。